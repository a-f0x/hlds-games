# hds-games
Запускает игру разных типов исходя из значений переменной ```GAME_TYPE```

Переменные среды:

* ``RCON_PASSWORD`` - пароль для вызова команд через Rcon protocol
* ```GAME_TYPE``` тип игры

  ``half-life`` - классический халф-лайф

  ``cs-classic`` - классический контр-страйк

  ``cs-dm`` - контр-страйк дезматч

## Как запустить

Запускаешь ``docker-compose up``

Затем в консоли Counter-Strike 1.6  ``connect 127.0.0.1:27015``

События можно посмотреть в очередях [rabbit](http://localhost:15672/#/queues/%2F/game-action)

`RABBITMQ_USER`=guestUsr

`RABBITMQ_PASSWORD`=guestPwd

#### Как это работает

1. Сначала идет определение типа игры которая должна быть запущена на основании значение переменной ```GAME_TYPE```
2. ``game.Agent`` запускает бинарь hlds_run с необходимыми параметрами.
3. Запускается на локальном хосте ``log.LogReceiver``, который слушает логи приходящие от сервера. Для фильтрации логов
   используется набор функций из ``parsers.go``.
4. После ``game.Agent`` запускает пинг локального сервера по протоколу Rcon каждые две секунды.
   При каждом успешном ответе на пинг отправляется сообщение в реббит в очередь ``heart-beat``.
5. При получении первого успешного ответа на пинг, начинают разбираться накопленные логи. Если лог попадает под паттерн,
   то отправляется сообщение в очередь ``game-action``.

## TODO

1. Реализовать сбор статистики локально на сервере. Видимо надо подобрать нужный плагин. Считать стату на основе логов
   неудобно. Могут быть не совпадения с реальной из-за потери эвентов. Ну и плагины собирают более детальную статистику.
2. Реализовать через GRPC управлене сервером - исполнение Rcon команд, что бы не стучаться по ркону напрямую в хост.
3. Реализовать телеграм бота для управления серверами с возможностью авторизации и групповыми чатами.